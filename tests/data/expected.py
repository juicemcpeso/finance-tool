# expected.py
# Expected results for tests
# 2024-01-30
# @juicemcpeso

allocation = [{'asset_class_id': 1,
               'location_id': 2,
               'current_value': 140000000,
               'plan_percent': 2000,
               'plan_value': 200000000,
               'deviation': -3000},
              {'asset_class_id': 2,
               'location_id': 2,
               'current_value': 40000000,
               'plan_percent': 500,
               'plan_value': 50000000,
               'deviation': -2000},
              {'asset_class_id': 1,
               'location_id': 1,
               'current_value': 340000000,
               'plan_percent': 4000,
               'plan_value': 400000000,
               'deviation': -1500},
              {'asset_class_id': 2,
               'location_id': 1,
               'current_value': 340000000,
               'plan_percent': 2500,
               'plan_value': 250000000,
               'deviation': 3600},
              {'asset_class_id': 3,
               'location_id': 1,
               'current_value': 140000000,
               'plan_percent': 1000,
               'plan_value': 100000000,
               'deviation': 4000}]

allocation_deviation_with_next_level = [{'asset_class_id': 1,
                                         'location_id': 2,
                                         'current_value': 140000000,
                                         'plan_percent': 2000,
                                         'plan_value': 200000000,
                                         'deviation': -3000,
                                         'next_deviation': -2000},
                                        {'asset_class_id': 1,
                                         'location_id': 2,
                                         'current_value': 140000000,
                                         'plan_percent': 2000,
                                         'plan_value': 200000000,
                                         'deviation': -3000,
                                         'next_deviation': -1500},
                                        {'asset_class_id': 1,
                                         'location_id': 2,
                                         'current_value': 140000000,
                                         'plan_percent': 2000,
                                         'plan_value': 200000000,
                                         'deviation': -3000,
                                         'next_deviation': 3600},
                                        {'asset_class_id': 1,
                                         'location_id': 2,
                                         'current_value': 140000000,
                                         'plan_percent': 2000,
                                         'plan_value': 200000000,
                                         'deviation': -3000,
                                         'next_deviation': 4000},
                                        {'asset_class_id': 2,
                                         'location_id': 2,
                                         'current_value': 40000000,
                                         'plan_percent': 500,
                                         'plan_value': 50000000,
                                         'deviation': -2000,
                                         'next_deviation': -1500},
                                        {'asset_class_id': 2,
                                         'location_id': 2,
                                         'current_value': 40000000,
                                         'plan_percent': 500,
                                         'plan_value': 50000000,
                                         'deviation': -2000,
                                         'next_deviation': 3600},
                                        {'asset_class_id': 2,
                                         'location_id': 2,
                                         'current_value': 40000000,
                                         'plan_percent': 500,
                                         'plan_value': 50000000,
                                         'deviation': -2000,
                                         'next_deviation': 4000},
                                        {'asset_class_id': 1,
                                         'location_id': 1,
                                         'current_value': 340000000,
                                         'plan_percent': 4000,
                                         'plan_value': 400000000,
                                         'deviation': -1500,
                                         'next_deviation': 3600},
                                        {'asset_class_id': 1,
                                         'location_id': 1,
                                         'current_value': 340000000,
                                         'plan_percent': 4000,
                                         'plan_value': 400000000,
                                         'deviation': -1500,
                                         'next_deviation': 4000},
                                        {'asset_class_id': 2,
                                         'location_id': 1,
                                         'current_value': 340000000,
                                         'plan_percent': 2500,
                                         'plan_value': 250000000,
                                         'deviation': 3600,
                                         'next_deviation': 4000}]

db_1 = {'account': [{'id': 1, 'name': 'Work 401k', 'account_type_id': 1, 'institution_id': 1, 'owner_id': 1}],
        'account_type': [{'id': 1, 'name': '401k', 'tax_in': 0, 'tax_growth': 0, 'tax_out': 1}],
        'allocation': [
            {'id': 1, 'asset_class_id': 1, 'location_id': 1, 'percentage': 4000},
            {'id': 2, 'asset_class_id': 1, 'location_id': 2, 'percentage': 2000},
            {'id': 3, 'asset_class_id': 2, 'location_id': 1, 'percentage': 2500},
            {'id': 4, 'asset_class_id': 2, 'location_id': 2, 'percentage': 500},
            {'id': 5, 'asset_class_id': 3, 'location_id': 1, 'percentage': 1000}],
        'asset': [
            {'id': 1, 'name': 'Rearguard Total Stock Market Index Fund', 'symbol': 'RSUSA'},
            {'id': 2, 'name': 'Rearguard Total International Stock Index Fund', 'symbol': 'RSINT'},
            {'id': 3, 'name': 'Rearguard Total Bond Market Index Fund', 'symbol': 'RBUSA'},
            {'id': 4, 'name': 'Rearguard Total International Bond Index Fund', 'symbol': 'RBINT'},
            {'id': 5, 'name': 'US Dollars', 'symbol': 'USD'}],
        'asset_class': [{'id': 1, 'name': 'stocks'},
                        {'id': 2, 'name': 'bonds'},
                        {'id': 3, 'name': 'cash'},
                        {'id': 4, 'name': 'other'}],
        'balance': [
            {'id': 1, 'account_id': 1, 'asset_id': 1, 'balance_date': '2021-01-01', 'quantity': 340000000},
            {'id': 2, 'account_id': 1, 'asset_id': 2, 'balance_date': '2021-01-01', 'quantity': 140000000},
            {'id': 3, 'account_id': 1, 'asset_id': 3, 'balance_date': '2021-01-01', 'quantity': 340000000},
            {'id': 4, 'account_id': 1, 'asset_id': 4, 'balance_date': '2021-01-01', 'quantity': 40000000},
            {'id': 5, 'account_id': 1, 'asset_id': 5, 'balance_date': '2021-01-01', 'quantity': 140000000}],
        'constant': [{'id': 1, 'name': 'decimal', 'amount': 10000}],
        'component': [{'id': 1, 'asset_id': 1, 'asset_class_id': 1, 'location_id': 1, 'percentage': 10000},
                      {'id': 2, 'asset_id': 2, 'asset_class_id': 1, 'location_id': 2, 'percentage': 10000},
                      {'id': 3, 'asset_id': 3, 'asset_class_id': 2, 'location_id': 1, 'percentage': 10000},
                      {'id': 4, 'asset_id': 4, 'asset_class_id': 2, 'location_id': 2, 'percentage': 10000},
                      {'id': 5, 'asset_id': 5, 'asset_class_id': 3, 'location_id': 1, 'percentage': 10000}],
        'institution': [{'id': 1, 'name': 'Rearguard Investments'}],
        'location': [
            {'id': 1, 'name': 'USA'},
            {'id': 2, 'name': 'International'},
            {'id': 3, 'name': 'World'}],
        'owner': [{'id': 1, 'name': 'Bob', 'birthday': '1992-10-31'}],
        'price': [{'id': 1, 'asset_id': 1, 'price_date': '2020-01-01', 'amount': 10000},
                  {'id': 2, 'asset_id': 2, 'price_date': '2020-01-01', 'amount': 10000},
                  {'id': 3, 'asset_id': 3, 'price_date': '2020-01-01', 'amount': 10000},
                  {'id': 4, 'asset_id': 4, 'price_date': '2020-01-01', 'amount': 10000},
                  {'id': 5, 'asset_id': 5, 'price_date': '1776-07-04', 'amount': 10000}]}

db_2 = {'account': [{'id': 1, 'name': 'Work 401k', 'account_type_id': 1, 'institution_id': 1, 'owner_id': 1},
                    {'id': 2, 'name': "Bob's Roth IRA", 'account_type_id': 2, 'institution_id': 1,
                     'owner_id': 1},
                    {'id': 3, 'name': "Bob's Bonds", 'account_type_id': 3, 'institution_id': 3, 'owner_id': 1},
                    {'id': 4, 'name': "Anna's Stocks", 'account_type_id': 3, 'institution_id': 1,
                     'owner_id': 2},
                    {'id': 5, 'name': "Anna's Savings", 'account_type_id': 3, 'institution_id': 2,
                     'owner_id': 2}],
        'account_type': [{'id': 1, 'name': '401k', 'tax_in': 0, 'tax_growth': 0, 'tax_out': 1},
                         {'id': 2, 'name': 'Roth IRA', 'tax_in': 1, 'tax_growth': 0, 'tax_out': 0},
                         {'id': 3, 'name': 'Taxable', 'tax_in': 1, 'tax_growth': 1, 'tax_out': 1}],
        'allocation': [{'id': 1, 'asset_class_id': 1, 'location_id': 1, 'percentage': 4000},
                       {'id': 2, 'asset_class_id': 1, 'location_id': 2, 'percentage': 2000},
                       {'id': 3, 'asset_class_id': 2, 'location_id': 1, 'percentage': 2500},
                       {'id': 4, 'asset_class_id': 2, 'location_id': 2, 'percentage': 500},
                       {'id': 5, 'asset_class_id': 3, 'location_id': 1, 'percentage': 1000}],
        'asset': [{'id': 1, 'name': 'US Dollars', 'symbol': 'USD'},
                  {'id': 2, 'name': 'Rearguard Total International Stock Index Fund', 'symbol': 'RINTL'},
                  {'id': 3, 'name': 'Rearguard Total Stock Market Index Fund', 'symbol': 'RUSIF'},
                  {'id': 4, 'name': 'Bullsye Investments Target Date Fund', 'symbol': 'BITDF'},
                  {'id': 5, 'name': 'Series 2021-12 J Bonds', 'symbol': 'J Bond'}],
        'asset_class': [{'id': 1, 'name': 'stocks'},
                        {'id': 2, 'name': 'bonds'},
                        {'id': 3, 'name': 'cash'},
                        {'id': 4, 'name': 'other'}],
        'balance': [{'id': 1, 'account_id': 1, 'asset_id': 4, 'balance_date': '2021-01-01', 'quantity': 50000},
                    {'id': 2, 'account_id': 1, 'asset_id': 4, 'balance_date': '2022-01-01',
                     'quantity': 500000},
                    {'id': 3, 'account_id': 2, 'asset_id': 3, 'balance_date': '2021-01-01', 'quantity': 90000},
                    {'id': 4, 'account_id': 2, 'asset_id': 3, 'balance_date': '2022-01-01',
                     'quantity': 1000000},
                    {'id': 5, 'account_id': 3, 'asset_id': 5, 'balance_date': '2021-12-15',
                     'quantity': 100000000},
                    {'id': 6, 'account_id': 4, 'asset_id': 2, 'balance_date': '2020-01-01',
                     'quantity': 40000000},
                    {'id': 7, 'account_id': 4, 'asset_id': 3, 'balance_date': '2021-01-01',
                     'quantity': 500000},
                    {'id': 8, 'account_id': 4, 'asset_id': 2, 'balance_date': '2022-01-01',
                     'quantity': 50000000},
                    {'id': 9, 'account_id': 5, 'asset_id': 1, 'balance_date': '2021-01-01',
                     'quantity': 160000000},
                    {'id': 10, 'account_id': 5, 'asset_id': 1, 'balance_date': '2022-01-01',
                     'quantity': 200000000}],
        'component': [{'id': 1, 'asset_id': 1, 'asset_class_id': 3, 'location_id': 1, 'percentage': 10000},
                      {'id': 2, 'asset_id': 2, 'asset_class_id': 1, 'location_id': 2, 'percentage': 10000},
                      {'id': 3, 'asset_id': 3, 'asset_class_id': 1, 'location_id': 1, 'percentage': 10000},
                      {'id': 4, 'asset_id': 4, 'asset_class_id': 1, 'location_id': 1, 'percentage': 5500},
                      {'id': 5, 'asset_id': 4, 'asset_class_id': 1, 'location_id': 2, 'percentage': 2500},
                      {'id': 6, 'asset_id': 4, 'asset_class_id': 2, 'location_id': 1, 'percentage': 1000},
                      {'id': 7, 'asset_id': 4, 'asset_class_id': 2, 'location_id': 2, 'percentage': 500},
                      {'id': 8, 'asset_id': 4, 'asset_class_id': 4, 'location_id': None, 'percentage': 500},
                      {'id': 9, 'asset_id': 5, 'asset_class_id': 2, 'location_id': 1, 'percentage': 10000}],
        'constant': [{'id': 1, 'name': 'decimal', 'amount': 10000}],
        'institution': [{'id': 1, 'name': 'Rearguard Investments'},
                        {'id': 2, 'name': 'Capital Two'},
                        {'id': 3, 'name': 'Treasury Indirect'}],
        'location': [{'id': 1, 'name': 'USA'},
                     {'id': 2, 'name': 'International'},
                     {'id': 3, 'name': 'World'}],
        'owner': [{'id': 1, 'name': 'Bob', 'birthday': '1992-10-31'},
                  {'id': 2, 'name': 'Anna', 'birthday': '1991-05-04'}],
        'price': [{'id': 1, 'asset_id': 1, 'price_date': '1776-07-04', 'amount': 10000},
                  {'id': 2, 'asset_id': 2, 'price_date': '2020-01-01', 'amount': 40000},
                  {'id': 3, 'asset_id': 2, 'price_date': '2022-01-01', 'amount': 20000},
                  {'id': 4, 'asset_id': 3, 'price_date': '2021-01-01', 'amount': 300000},
                  {'id': 5, 'asset_id': 3, 'price_date': '2022-01-01', 'amount': 500000},
                  {'id': 6, 'asset_id': 3, 'price_date': '2022-12-01', 'amount': 400000},
                  {'id': 7, 'asset_id': 4, 'price_date': '2021-01-01', 'amount': 600000},
                  {'id': 8, 'asset_id': 4, 'price_date': '2022-01-01', 'amount': 800000},
                  {'id': 9, 'asset_id': 5, 'price_date': '2021-12-15', 'amount': 10000}]}
deviation_levels = [{'deviation': d['deviation']} for d in allocation]

first_lines = {
    'account': [{'id': 1, 'name': 'Work 401k', 'account_type_id': 1, 'institution_id': 1, 'owner_id': 1}],
    'account_type': [{'id': 1, 'name': '401k', 'tax_in': 0, 'tax_growth': 0, 'tax_out': 1}],
    'allocation': [{'id': 1, 'asset_class_id': 1, 'location_id': 1, 'percentage': 4000}],
    'asset': [{'id': 1, 'name': 'Rearguard Total Stock Market Index Fund', 'symbol': 'RSUSA'}],
    'asset_class': [{'id': 1, 'name': 'stocks'}],
    'balance': [
        {'id': 1, 'account_id': 1, 'asset_id': 1, 'balance_date': '2021-01-01', 'quantity': 340000000}],
    'component': [{'id': 1, 'asset_id': 1, 'asset_class_id': 1, 'location_id': 1, 'percentage': 10000}],
    'constant': [{'id': 1, 'name': 'decimal', 'amount': 10000}],
    'institution': [{'id': 1, 'name': 'Rearguard Investments'}],
    'location': [{'id': 1, 'name': 'USA'}],
    'owner': [{'id': 1, 'name': 'Bob', 'birthday': '1992-10-31'}],
    'price': [{'id': 1, 'asset_id': 1, 'price_date': '1776-07-04', 'amount': 10000}]}

sum_value_difference_at_each_deviation_level = [{'deviation': -2000, 'total_difference': 20000000},
                                                {'deviation': -1500, 'total_difference': 32500000},
                                                {'deviation': 3600, 'total_difference': 364000000},
                                                {'deviation': 4000, 'total_difference': 400000000}]

value_at_each_deviation_level = [{'asset_class_id': 1,
                                  'location_id': 2,
                                  'current_value': 140000000,
                                  'plan_percent': 2000,
                                  'plan_value': 200000000,
                                  'deviation': -3000,
                                  'level_value': 160000000,
                                  'next_deviation': -2000},
                                 {'asset_class_id': 1,
                                  'location_id': 2,
                                  'current_value': 140000000,
                                  'plan_percent': 2000,
                                  'plan_value': 200000000,
                                  'deviation': -3000,
                                  'level_value': 170000000,
                                  'next_deviation': -1500},
                                 {'asset_class_id': 1,
                                  'location_id': 2,
                                  'current_value': 140000000,
                                  'plan_percent': 2000,
                                  'plan_value': 200000000,
                                  'deviation': -3000,
                                  'level_value': 272000000,
                                  'next_deviation': 3600},
                                 {'asset_class_id': 1,
                                  'location_id': 2,
                                  'current_value': 140000000,
                                  'plan_percent': 2000,
                                  'plan_value': 200000000,
                                  'deviation': -3000,
                                  'level_value': 280000000,
                                  'next_deviation': 4000},
                                 {'asset_class_id': 2,
                                  'location_id': 2,
                                  'current_value': 40000000,
                                  'plan_percent': 500,
                                  'plan_value': 50000000,
                                  'deviation': -2000,
                                  'level_value': 42500000,
                                  'next_deviation': -1500},
                                 {'asset_class_id': 2,
                                  'location_id': 2,
                                  'current_value': 40000000,
                                  'plan_percent': 500,
                                  'plan_value': 50000000,
                                  'deviation': -2000,
                                  'level_value': 68000000,
                                  'next_deviation': 3600},
                                 {'asset_class_id': 2,
                                  'location_id': 2,
                                  'current_value': 40000000,
                                  'plan_percent': 500,
                                  'plan_value': 50000000,
                                  'deviation': -2000,
                                  'level_value': 70000000,
                                  'next_deviation': 4000},
                                 {'asset_class_id': 1,
                                  'location_id': 1,
                                  'current_value': 340000000,
                                  'plan_percent': 4000,
                                  'plan_value': 400000000,
                                  'deviation': -1500,
                                  'level_value': 544000000,
                                  'next_deviation': 3600},
                                 {'asset_class_id': 1,
                                  'location_id': 1,
                                  'current_value': 340000000,
                                  'plan_percent': 4000,
                                  'plan_value': 400000000,
                                  'deviation': -1500,
                                  'level_value': 560000000,
                                  'next_deviation': 4000},
                                 {'asset_class_id': 2,
                                  'location_id': 1,
                                  'current_value': 340000000,
                                  'plan_percent': 2500,
                                  'plan_value': 250000000,
                                  'deviation': 3600,
                                  'level_value': 350000000,
                                  'next_deviation': 4000}]

value_difference_deviation_level = [{'asset_class_id': 1,
                                     'location_id': 2,
                                     'current_value': 140000000,
                                     'plan_percent': 2000,
                                     'plan_value': 200000000,
                                     'deviation': -3000,
                                     'level_value': 160000000,
                                     'value_difference': 20000000,
                                     'next_deviation': -2000},
                                    {'asset_class_id': 1,
                                     'location_id': 2,
                                     'current_value': 140000000,
                                     'plan_percent': 2000,
                                     'plan_value': 200000000,
                                     'deviation': -3000,
                                     'level_value': 170000000,
                                     'value_difference': 30000000,
                                     'next_deviation': -1500},
                                    {'asset_class_id': 1,
                                     'location_id': 2,
                                     'current_value': 140000000,
                                     'plan_percent': 2000,
                                     'plan_value': 200000000,
                                     'deviation': -3000,
                                     'level_value': 272000000,
                                     'value_difference': 132000000,
                                     'next_deviation': 3600},
                                    {'asset_class_id': 1,
                                     'location_id': 2,
                                     'current_value': 140000000,
                                     'plan_percent': 2000,
                                     'plan_value': 200000000,
                                     'deviation': -3000,
                                     'level_value': 280000000,
                                     'value_difference': 140000000,
                                     'next_deviation': 4000},
                                    {'asset_class_id': 2,
                                     'location_id': 2,
                                     'current_value': 40000000,
                                     'plan_percent': 500,
                                     'plan_value': 50000000,
                                     'deviation': -2000,
                                     'level_value': 42500000,
                                     'value_difference': 2500000,
                                     'next_deviation': -1500},
                                    {'asset_class_id': 2,
                                     'location_id': 2,
                                     'current_value': 40000000,
                                     'plan_percent': 500,
                                     'plan_value': 50000000,
                                     'deviation': -2000,
                                     'level_value': 68000000,
                                     'value_difference': 28000000,
                                     'next_deviation': 3600},
                                    {'asset_class_id': 2,
                                     'location_id': 2,
                                     'current_value': 40000000,
                                     'plan_percent': 500,
                                     'plan_value': 50000000,
                                     'deviation': -2000,
                                     'level_value': 70000000,
                                     'value_difference': 30000000,
                                     'next_deviation': 4000},
                                    {'asset_class_id': 1,
                                     'location_id': 1,
                                     'current_value': 340000000,
                                     'plan_percent': 4000,
                                     'plan_value': 400000000,
                                     'deviation': -1500,
                                     'level_value': 544000000,
                                     'value_difference': 204000000,
                                     'next_deviation': 3600},
                                    {'asset_class_id': 1,
                                     'location_id': 1,
                                     'current_value': 340000000,
                                     'plan_percent': 4000,
                                     'plan_value': 400000000,
                                     'deviation': -1500,
                                     'level_value': 560000000,
                                     'value_difference': 220000000,
                                     'next_deviation': 4000},
                                    {'asset_class_id': 2,
                                     'location_id': 1,
                                     'current_value': 340000000,
                                     'plan_percent': 2500,
                                     'plan_value': 250000000,
                                     'deviation': 3600,
                                     'level_value': 350000000,
                                     'value_difference': 10000000,
                                     'next_deviation': 4000}]

where_to_contribute = {0: [],
                       1000: [{'asset_class_id': 1,
                               'location_id': 2,
                               'contribution': 10000000}],
                       10000: [{'asset_class_id': 1,
                                'location_id': 2,
                                'contribution': 50765539},
                               {'asset_class_id': 2,
                                'location_id': 2,
                                'contribution': 7691385},
                               {'asset_class_id': 1,
                                'location_id': 1,
                                'contribution': 41543076}],
                       100000: [{'asset_class_id': 1,
                                 'location_id': 2,
                                 'contribution': 260000000},
                                {'asset_class_id': 2,
                                 'location_id': 2,
                                 'contribution': 60000000},
                                {'asset_class_id': 1,
                                 'location_id': 1,
                                 'contribution': 460000000},
                                {'asset_class_id': 2,
                                 'location_id': 1,
                                 'contribution': 160000000},
                                {'asset_class_id': 3,
                                 'location_id': 1,
                                 'contribution': 60000000}]}
